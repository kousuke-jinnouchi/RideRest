<div class="container my-4">
  <div class="card shadow-sm border-0">
    <div class="row g-0">
      <div class="col-md-6">
        <%= image_tag @parking_lot.get_image, class: 'img-fluid rounded-start w-100', style: 'object-fit: cover; height: 100%; min-height: 350px;' %>
      </div>
      <div class="col-md-6 d-flex flex-column">
        <div class="card-body">
          <p class="card-text mb-2">
            <span class="badge bg-primary rounded-pill"><%= @parking_lot.genre.name %></span>
          </p>
          <h2 class="card-title h3 mb-1"><%= @parking_lot.parking_lot_name %></h2>
          <% if @parking_lot.tag_list.present? %>
            <div class="mb-3">
              <% @parking_lot.tag_list.each do |tag| %>
                <%= link_to parking_lots_path(tag: tag), class: "btn btn-sm btn-outline-info me-2 mb-2" do %>
                  <i class="fas fa-tag mr-1"></i><%= tag %>
                <% end %>
              <% end %>
            </div>
          <% end %>
          <p class="card-subtitle mb-3 text-muted">
            <i class="fas fa-map-marker-alt"></i> 
            <%= @parking_lot.address %>
          </p>
          <p class="card-text bg-light p-3 rounded"><%= @parking_lot.description %></p>
          <div class="d-flex justify-content-between align-items-center p-3 my-3 bg-white rounded shadow-sm border-left border-success" style="border-width: 4px !important;">
            <span class="h5 mb-0 text-dark">料金</span>
            <span class="h4 mb-0 text-success font-weight-bold"><%= @parking_lot.fee %></span>
          </div>
          <% if @parking_lot.user == current_user %>
            <div class="d-flex">
              <%= link_to "この投稿を編集する", edit_parking_lot_path(@parking_lot), class: 'btn btn-outline-info mr-2' %>
              <%= link_to "この投稿を削除する", parking_lot_path(@parking_lot), method: :delete, data: { confirm: '本当に削除しますか？' }, class: 'btn btn-outline-danger' %>
            </div>
          <% end %>
        </div>

        <div class="card-footer bg-transparent border-top-0 mt-auto">
          <div class="d-flex align-items-center">
            <%= image_tag @parking_lot.user.get_profile_image(100, 100), class: 'rounded-circle me-3', width: 45, height: 45 %>
            <div>
              <div class="text-muted small">投稿者: <%= @parking_lot.user.name %></div>
              <div class="text-muted small">投稿日: <%= @parking_lot.created_at.strftime('%Y/%m/%d') %></div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="mb-4">
          <%= form_with model: [@parking_lot, @comment] do |f| %>
            <div class="mb-3">
              <%= f.text_area :body, rows: 5, class: 'form-control', placeholder: "コメントをここに" %>
            </div>
            <div class="text-end">
              <%= f.submit "送信する", class: 'btn btn-primary' %>
            </div>
          <% end %>
        </div>
        <div>
          <h4 class="border-bottom pb-2 mb-3">
            コメント件数：<%= @parking_lot.comments.count %>件
          </h4>
          <% @parking_lot.comments.each do |comment| %>
            <div class="d-flex mb-3">
              <div class="flex-shrink-0">
                <%= image_tag comment.user.get_profile_image(100,100), class: 'rounded-circle', style: 'width: 50px; height: 50px;' %>
              </div>
              <div class="ms-3 flex-grow-1">
                <div class="fw-bold"><%= comment.user.name %></div>
                <div class="text-muted small mb-1"><%= comment.created_at.strftime('%Y/%m/%d') %></div>
                <p class="mb-1"><%= comment.body %></p>
                <% if comment.user == current_user %>
                  <div class="text-end">
                    <%= link_to '削除', parking_lot_comment_path(comment.parking_lot, comment), method: :delete, data: { confirm: '本当に削除しますか？' }, class: 'btn btn-outline-danger' %>
                  </div>
                <% end %>
              </div>
            </div>
            <hr>
          <% end %>
          <% if @parking_lot.comments.blank? %>
            <p class="text-muted">コメントはまだありません。</p>
          <% end %>
        </div>

      </div>
    </div>
  </div>
</div>